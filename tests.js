var lc = require("./lambda.js"), L = lc.Lam, V = lc.Var, A = lc.App;
var ln = require("./lamnet.js");
var lpu = require("./LPU.js");

for (var i=0; i<=50; ++i){
    //var i = 2;
    var n = lc.nat;
    var S = lpu.from_term(S, A(n(i),n(i)));
    var time = Date.now();
    var result = lpu.reduce(S, {
        //save_file  : "history.txt",
        //get_history: true,
        //interactive: true
        }).stats;
    console.log(i+"^"+i+":\t "+result.clocks+" clocks,\t "+result.memory+ " allocated bytes,\t "+result.graph_rewrites+" graph rewrites, "+(Date.now()-time)/1000+" seconds.");
};

(function generate_stats_ascii(){
    var opt = [
        [8,360,1,0.015],
        [20,720,2,0],
        [63,1296,14,0],
        [157,2232,36,0.001],
        [325,3744,68,0.001],
        [603,5976,110,0.001],
        [1039,9072,162,0.005],
        [1693,13176,224,0],
        [2637,18432,296,0],
        [3955,24984,378,0.009],
        [5743,32976,470,0.006],
        [8109,42552,572,0.008],
        [11173,53856,684,0.003],
        [15067,67032,806,0.003],
        [19935,82224,938,0.004],
        [25933,99576,1080,0.011],
        [33229,119232,1232,0.007],
        [42003,141336,1394,0.008],
        [52447,166032,1566,0.011],
        [64765,193464,1748,0.026],
        [79173,223776,1940,0.026],
        [95899,257112,2142,0.024],
        [115183,293616,2354,0.026],
        [137277,333432,2576,0.046],
        [162445,376704,2808,0.053],
        [190963,423576,3050,0.062],
        [223119,474192,3302,0.074],
        [259213,528696,3564,0.087],
        [299557,587232,3836,0.088],
        [344475,649944,4118,0.088],
        [394303,716976,4410,0.075],
        [449389,788472,4712,0.141],
        [510093,864576,5024,0.156],
        [576787,945432,5346,0.176],
        [649855,1031184,5678,0.206],
        [729693,1121976,6020,0.23],
        [816709,1217952,6372,0.276],
        [911323,1319256,6734,0.289],
        [1013967,1426032,7106,0.315],
        [1125085,1538424,7488,0.344],
        [1245133,1656576,7880,0.399],
        [1374579,1780632,8282,0.444],
        [1513903,1910736,8694,0.518],
        [1663597,2047032,9116,0.723],
        [1824165,2189664,9548,0.605],
        [1996123,2338776,9990,0.661],
        [2179999,2494512,10442,0.703],
        [2376333,2657016,10904,0.744],
        [2585677,2826432,11376,0.818],
        [2808595,3002904,11858,0.897],
        [3045663,3186576,12350,1.008]];
    var lpu = [
        [42,240,7,0.017],
        [20,240,2,0],
        [124,512,14,0.002],
        [308,864,36,0.005],
        [623,1296,68,0.005],
        [988,1872,110,0.004],
        [1418,2560,162,0.007],
        [2036,3376,224,0.013],
        [2719,4336,296,0.022],
        [3500,5440,378,0.032],
        [4409,6656,470,0.047],
        [5374,8016,572,0.074],
        [6512,9568,684,0.097],
        [7799,11216,806,0.126],
        [9106,12928,938,0.167],
        [10463,14832,1080,0.239],
        [12053,16832,1232,0.302],
        [13660,18928,1394,0.379],
        [15263,21216,1566,0.481],
        [17012,23600,1748,0.552],
        [18967,26112,1940,0.686],
        [20987,28784,2142,0.843],
        [23105,31552,2354,1.034],
        [25333,34416,2576,1.188],
        [27590,37472,2808,1.486],
        [29960,40624,3050,1.695],
        [32464,43904,3302,1.97],
        [35003,47344,3564,2.263],
        [37757,50880,3836,2.693],
        [40555,54512,4118,3.147],
        [43325,58336,4410,3.518],
        [46445,62256,4712,3.912],
        [49516,66304,5024,4.436],
        [52700,70512,5346,4.872],
        [56141,74816,5678,5.688],
        [59536,79216,6020,6.242],
        [63092,83808,6372,7.08],
        [66809,88496,6734,7.815],
        [70612,93312,7106,8.741],
        [74045,98288,7488,9.74],
        [78083,103360,7880,10.837],
        [82135,108528,8282,12.833],
        [86285,113888,8694,15.088],
        [90653,119344,9116,16.719],
        [94549,124928,9548,21.078],
        [98942,130672,9990,28.472],
        [103655,136512,10442,26.761],
        [108208,142448,10904,30.695],
        [113003,148576,11376,27.723],
        [117515,154800,11858,27.795],
        [122365,161152,12350,30.117]]
    function pad(size){
        return function(str){
            str = String(str);
            while (str.length < size) str = " " + str;
            return str;
        };
    };
    function row(row){
        return row.map(pad(16)).join("");
    };
    console.log(pad(3*16)("OPT")+pad(2*16)("")+pad(3*16)("LPU")+pad(2*16)(""))
    console.log(row(((x)=>x.concat(x))(["i^i","steps/clocks","bytes","rewrites","time"]).concat(["l.time/o.time"])));
    for (var i=0; i<opt.length; ++i){
        var o = opt[i], l = lpu[i];
        console.log
            ( row([i, o[0], o[1], o[2], o[3].toFixed(3)])
            + row([i, l[0], l[1], l[2], l[3].toFixed(3)])
            + pad(16)((l[3]/o[3]).toFixed(3)));
    };
})();
